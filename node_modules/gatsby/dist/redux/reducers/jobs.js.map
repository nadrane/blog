{"version":3,"sources":["../../../src/redux/reducers/jobs.js"],"names":["_","require","oneLine","moment","module","exports","state","active","done","action","type","payload","id","Error","index","findIndex","j","mergedJob","merge","createdAt","Date","now","plugin","slice","concat","completedAt","job","find","get","runTime","diff","filter"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst { oneLine } = require(`common-tags`)\nconst moment = require(`moment`)\n\nmodule.exports = (state = { active: [], done: [] }, action) => {\n  switch (action.type) {\n    case `CREATE_JOB`:\n    case `SET_JOB`: {\n      if (!action.payload.id) {\n        throw new Error(`An ID must be provided when creating or setting job`)\n      }\n      const index = _.findIndex(state.active, j => j.id === action.payload.id)\n      const mergedJob = _.merge(state.active[index], {\n        ...action.payload,\n        createdAt: Date.now(),\n        plugin: action.plugin,\n      })\n      if (index !== -1) {\n        return {\n          done: state.done,\n          active: [\n            ...state.active\n              .slice(0, index)\n              .concat([mergedJob])\n              .concat(state.active.slice(index + 1)),\n          ],\n        }\n      } else {\n        return {\n          done: state.done,\n          active: state.active.concat([\n            {\n              ...action.payload,\n              createdAt: Date.now(),\n              plugin: action.plugin,\n            },\n          ]),\n        }\n      }\n    }\n    case `END_JOB`: {\n      if (!action.payload.id) {\n        throw new Error(`An ID must be provided when ending a job`)\n      }\n      const completedAt = Date.now()\n      const job = state.active.find(j => j.id === action.payload.id)\n      if (!job) {\n        throw new Error(oneLine`\n          The plugin \"${_.get(action, `plugin.name`, `anonymous`)}\"\n          tried to end a job with the id \"${action.payload.id}\"\n          that either hasn't yet been created or has already been ended`)\n      }\n\n      return {\n        done: state.done.concat([\n          {\n            ...job,\n            completedAt,\n            runTime: moment(completedAt).diff(moment(job.createdAt)),\n          },\n        ]),\n        active: state.active.filter(j => j.id !== action.payload.id),\n      }\n    }\n  }\n\n  return state\n}\n"],"file":"jobs.js"}