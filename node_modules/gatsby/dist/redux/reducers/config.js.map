{"version":3,"sources":["../../../src/redux/reducers/config.js"],"names":["Joi","require","chalk","_","gatsbyConfigSchema","module","exports","state","action","type","result","validate","payload","error","console","log","blue","bgYellow","bold","red","linkPrefix","Error","pathPrefix","startsWith","endsWith","slice","has","set"],"mappings":";;AAAA,MAAMA,GAAG,GAAGC,OAAO,CAAE,KAAF,CAAnB;;AACA,MAAMC,KAAK,GAAGD,OAAO,CAAE,OAAF,CAArB;;AACA,MAAME,CAAC,GAAGF,OAAO,CAAE,QAAF,CAAjB;;iBAE+BA,OAAO,CAAE,uBAAF,C;MAA9BG,kB,YAAAA,kB;;AAERC,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG,EAAT,EAAaC,MAAb,KAAwB;AACvC,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,iBAAN;AAAwB;AACtB;AACA,cAAMC,MAAM,GAAGV,GAAG,CAACW,QAAJ,CAAaH,MAAM,CAACI,OAApB,EAA6BR,kBAA7B,CAAf,CAFsB,CAGtB;AACA;AACA;;AACA,YAAIM,MAAM,CAACG,KAAX,EAAkB;AAChBC,UAAAA,OAAO,CAACC,GAAR,CACEb,KAAK,CAACc,IAAN,CAAWC,QAAX,CAAqB,+CAArB,CADF;AAGAH,UAAAA,OAAO,CAACC,GAAR,CAAYb,KAAK,CAACgB,IAAN,CAAWC,GAAX,CAAeT,MAAM,CAACG,KAAtB,CAAZ;;AACA,cAAIL,MAAM,CAACI,OAAP,CAAeQ,UAAnB,EAA+B;AAC7BN,YAAAA,OAAO,CAACC,GAAR,CAAa,gDAAb;AACD;;AACD,gBAAM,IAAIM,KAAJ,CAAW,+CAAX,CAAN;AACD,SAfqB,CAiBtB;AACA;;;AACA,YAAIb,MAAM,CAACI,OAAP,IAAkBJ,MAAM,CAACI,OAAP,CAAeU,UAArC,EAAiD;AAC/C,cAAI,CAACnB,CAAC,CAACoB,UAAF,CAAaf,MAAM,CAACI,OAAP,CAAeU,UAA5B,EAAyC,GAAzC,CAAL,EAAmD;AACjDd,YAAAA,MAAM,CAACI,OAAP,CAAeU,UAAf,GAA6B,IAAGd,MAAM,CAACI,OAAP,CAAeU,UAAW,EAA1D;AACD;;AACD,cAAInB,CAAC,CAACqB,QAAF,CAAWhB,MAAM,CAACI,OAAP,CAAeU,UAA1B,EAAuC,GAAvC,CAAJ,EAAgD;AAC9Cd,YAAAA,MAAM,CAACI,OAAP,CAAeU,UAAf,GAA4Bd,MAAM,CAACI,OAAP,CAAeU,UAAf,CAA0BG,KAA1B,CAAgC,CAAhC,EAAmC,CAAC,CAApC,CAA5B;AACD;AACF,SA1BqB,CA4BtB;AACA;;;AACA,YAAI,CAACtB,CAAC,CAACuB,GAAF,CAAMlB,MAAN,EAAc,CAAE,SAAF,EAAa,YAAb,CAAd,CAAL,EAA+C;AAC7CA,UAAAA,MAAM,GAAGL,CAAC,CAACwB,GAAF,CAAMnB,MAAN,EAAc,CAAE,SAAF,EAAa,YAAb,CAAd,EAA0C,EAA1C,CAAT;AACD,SAhCqB,CAkCtB;;;AACA,YAAI,CAACL,CAAC,CAACuB,GAAF,CAAMlB,MAAN,EAAc,CAAE,SAAF,EAAa,UAAb,CAAd,CAAL,EAA6C;AAC3CA,UAAAA,MAAM,GAAGL,CAAC,CAACwB,GAAF,CAAMnB,MAAN,EAAc,CAAE,SAAF,EAAa,UAAb,CAAd,EAAuC,IAAvC,CAAT;AACD;;AAED,iCACKA,MAAM,CAACI,OADZ;AAGD;;AACD;AACE,aAAOL,KAAP;AA7CJ;AA+CD,CAhDD","sourcesContent":["const Joi = require(`joi`)\nconst chalk = require(`chalk`)\nconst _ = require(`lodash`)\n\nconst { gatsbyConfigSchema } = require(`../../joi-schemas/joi`)\n\nmodule.exports = (state = {}, action) => {\n  switch (action.type) {\n    case `SET_SITE_CONFIG`: {\n      // Validate the config.\n      const result = Joi.validate(action.payload, gatsbyConfigSchema)\n      // TODO use Redux for capturing errors from different\n      // parts of Gatsby so a) can capture richer errors and b) be\n      // more flexible how to display them.\n      if (result.error) {\n        console.log(\n          chalk.blue.bgYellow(`The site's gatsby-config.js failed validation`)\n        )\n        console.log(chalk.bold.red(result.error))\n        if (action.payload.linkPrefix) {\n          console.log(`\"linkPrefix\" should be changed to \"pathPrefix\"`)\n        }\n        throw new Error(`The site's gatsby-config.js failed validation`)\n      }\n\n      // Ensure that the pathPrefix (if set) starts with a forward slash\n      // and doesn't end with a slash.\n      if (action.payload && action.payload.pathPrefix) {\n        if (!_.startsWith(action.payload.pathPrefix, `/`)) {\n          action.payload.pathPrefix = `/${action.payload.pathPrefix}`\n        }\n        if (_.endsWith(action.payload.pathPrefix, `/`)) {\n          action.payload.pathPrefix = action.payload.pathPrefix.slice(0, -1)\n        }\n      }\n\n      // If pathPrefix isn't set, set it to an empty string\n      // to avoid it showing up as undefined elsewhere.\n      if (!_.has(action, [`payload`, `pathPrefix`])) {\n        action = _.set(action, [`payload`, `pathPrefix`], ``)\n      }\n\n      // Default polyfill to true.\n      if (!_.has(action, [`payload`, `polyfill`])) {\n        action = _.set(action, [`payload`, `polyfill`], true)\n      }\n\n      return {\n        ...action.payload,\n      }\n    }\n    default:\n      return state\n  }\n}\n"],"file":"config.js"}