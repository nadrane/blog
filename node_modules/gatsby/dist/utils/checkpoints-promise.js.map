{"version":3,"sources":["../../src/utils/checkpoints-promise.js"],"names":["Promise","require","_","emitter","waiters","on","action","stage","payload","map","w","newWaiter","resolve","events","difference","length","undefined","filter","module","exports","push"],"mappings":";;AAAA;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAE,UAAF,CAAvB;;AACA,MAAMC,CAAC,GAAGD,OAAO,CAAE,QAAF,CAAjB;;iBAEoBA,OAAO,CAAE,UAAF,C;MAAnBE,O,YAAAA,O;;AAER,IAAIC,OAAO,GAAG,EAAd;AACAD,OAAO,CAACE,EAAR,CAAY,iBAAZ,EAA8BC,MAAM,IAAI;AACtC,QAAMC,KAAK,GAAGD,MAAM,CAACE,OAAP,CAAeD,KAA7B,CADsC,CAEtC;;AACAH,EAAAA,OAAO,GAAGA,OAAO,CAACK,GAAR,CAAYC,CAAC,IAAI;AACzB,UAAMC,SAAS,GAAG;AAChBC,MAAAA,OAAO,EAAEF,CAAC,CAACE,OADK;AAEhBC,MAAAA,MAAM,EAAEX,CAAC,CAACY,UAAF,CAAaJ,CAAC,CAACG,MAAf,EAAuB,CAACN,KAAD,CAAvB;AAFQ,KAAlB;;AAKA,QAAII,SAAS,CAACE,MAAV,CAAiBE,MAAjB,KAA4B,CAAhC,EAAmC;AACjC;AACAJ,MAAAA,SAAS,CAACC,OAAV;AACA,aAAOI,SAAP;AACD,KAJD,MAIO;AACL,aAAOL,SAAP;AACD;AACF,GAbS,CAAV,CAHsC,CAkBtC;;AACAP,EAAAA,OAAO,GAAGF,CAAC,CAACe,MAAF,CAASb,OAAT,CAAV;AACD,CApBD;;AAsBAc,MAAM,CAACC,OAAP,GAAiB,CAAC;AAAEN,EAAAA;AAAF,CAAD,KACf,IAAIb,OAAJ,CAAYY,OAAO,IAAI;AACrBR,EAAAA,OAAO,CAACgB,IAAR,CAAa;AACXR,IAAAA,OADW;AAEXC,IAAAA;AAFW,GAAb;AAID,CALD,CADF","sourcesContent":["// Wait for things to happen before continuing.\nconst Promise = require(`bluebird`)\nconst _ = require(`lodash`)\n\nconst { emitter } = require(`../redux`)\n\nlet waiters = []\nemitter.on(`BOOTSTRAP_STAGE`, action => {\n  const stage = action.payload.stage\n  // Remove this stage from the waiters\n  waiters = waiters.map(w => {\n    const newWaiter = {\n      resolve: w.resolve,\n      events: _.difference(w.events, [stage]),\n    }\n\n    if (newWaiter.events.length === 0) {\n      // Call resolve function then remove by returning undefined.\n      newWaiter.resolve()\n      return undefined\n    } else {\n      return newWaiter\n    }\n  })\n\n  // Cleanup null entries\n  waiters = _.filter(waiters)\n})\n\nmodule.exports = ({ events }) =>\n  new Promise(resolve => {\n    waiters.push({\n      resolve,\n      events,\n    })\n  })\n"],"file":"checkpoints-promise.js"}