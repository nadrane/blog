{"version":3,"sources":["../../src/bootstrap/index.js"],"names":["_","require","slash","fs","md5File","crypto","del","path","convertHrtime","Promise","apiRunnerNode","mergeGatsbyConfig","getBrowserslist","graphql","store","emitter","loadPlugins","report","getConfigFile","tracer","globalTracer","preferDefault","process","on","reason","p","panic","extractQueries","runInitialQueries","queryQueue","writePages","writeRedirects","module","exports","args","spanArgs","parentSpan","childOf","bootstrapSpan","startSpan","directory","program","browserslist","dispatch","type","payload","activity","activityTimer","start","config","__experimentalThemes","themesConfig","mapSeries","plugin","themeName","resolve","themeConfig","options","theme","themeConfigObj","isFunction","plugins","reduce","polyfill","warn","end","flattenedPlugins","span","pluginVersions","map","version","hashes","all","catch","pluginsHash","createHash","update","JSON","stringify","concat","digest","state","getState","oldPluginsHash","status","PLUGINS_HASH","info","stripIndent","remove","e","error","ensureDir","srcDir","__dirname","siteDir","tryRequire","copy","clobber","ensureDirSync","emptyDir","err","hasAPIFile","env","skipSSR","undefined","envAPIs","name","join","Array","isArray","length","ssrPlugins","filter","pluginOptions","browserPlugins","browserPluginsRequires","browserAPIRunner","sSRAPIRunner","readFileSync","ssrPluginsRequires","writeFileSync","build","extensions","apiResults","traceId","flattenDeep","graphqlRunner","query","context","schema","waitForCascadingActions","printConflicts","NODE_ENV","startQueries","hrtime","stats","getStats","setStatus","total","peak","seconds","toFixed","checkJobsDone","debounce","jobs","active","log","uptime","then","finish","emit"],"mappings":"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","sourcesContent":["/* @flow */\n\nconst _ = require(`lodash`)\nconst slash = require(`slash`)\nconst fs = require(`fs-extra`)\nconst md5File = require(`md5-file/promise`)\nconst crypto = require(`crypto`)\nconst del = require(`del`)\nconst path = require(`path`)\nconst convertHrtime = require(`convert-hrtime`)\nconst Promise = require(`bluebird`)\n\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst mergeGatsbyConfig = require(`../utils/merge-gatsby-config`)\nconst getBrowserslist = require(`../utils/browserslist`)\nconst { graphql } = require(`graphql`)\nconst { store, emitter } = require(`../redux`)\nconst loadPlugins = require(`./load-plugins`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst getConfigFile = require(`./get-config-file`)\nconst tracer = require(`opentracing`).globalTracer()\nconst preferDefault = require(`./prefer-default`)\n\n// Show stack trace on unhandled promises.\nprocess.on(`unhandledRejection`, (reason, p) => {\n  report.panic(reason)\n})\n\nconst {\n  extractQueries,\n} = require(`../internal-plugins/query-runner/query-watcher`)\nconst {\n  runInitialQueries,\n} = require(`../internal-plugins/query-runner/page-query-runner`)\nconst queryQueue = require(`../internal-plugins/query-runner/query-queue`)\nconst { writePages } = require(`../internal-plugins/query-runner/pages-writer`)\nconst {\n  writeRedirects,\n} = require(`../internal-plugins/query-runner/redirects-writer`)\n\n// Override console.log to add the source file + line number.\n// Useful for debugging if you lose a console.log somewhere.\n// Otherwise leave commented out.\n// require(`./log-line-function`)\n\ntype BootstrapArgs = {\n  directory: string,\n  prefixPaths?: boolean,\n  parentSpan: Object,\n}\n\nmodule.exports = async (args: BootstrapArgs) => {\n  const spanArgs = args.parentSpan ? { childOf: args.parentSpan } : {}\n  const bootstrapSpan = tracer.startSpan(`bootstrap`, spanArgs)\n\n  // Start plugin runner which listens to the store\n  // and invokes Gatsby API based on actions.\n  require(`../redux/plugin-runner`)\n\n  const directory = slash(args.directory)\n\n  const program = {\n    ...args,\n    browserslist: getBrowserslist(directory),\n    // Fix program directory path for windows env.\n    directory,\n  }\n\n  store.dispatch({\n    type: `SET_PROGRAM`,\n    payload: program,\n  })\n\n  // Try opening the site's gatsby-config.js file.\n  let activity = report.activityTimer(`open and validate gatsby-configs`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  let config = await preferDefault(\n    getConfigFile(program.directory, `gatsby-config`)\n  )\n\n  // theme gatsby configs can be functions or objects\n  if (config && config.__experimentalThemes) {\n    const themesConfig = await Promise.mapSeries(\n      config.__experimentalThemes,\n      async plugin => {\n        const themeName = plugin.resolve || plugin\n        const themeConfig = plugin.options || {}\n        const theme = await preferDefault(\n          getConfigFile(themeName, `gatsby-config`)\n        )\n        // if theme is a function, call it with the themeConfig\n        let themeConfigObj = theme\n        if (_.isFunction(theme)) {\n          themeConfigObj = theme(themeConfig)\n        }\n        // themes function as plugins too (gatsby-node, etc)\n        return {\n          ...themeConfigObj,\n          plugins: [\n            ...(themeConfigObj.plugins || []),\n            // theme plugin is last so it's gatsby-node, etc can override it's declared plugins, like a normal site.\n            { resolve: themeName, options: themeConfig },\n          ],\n        }\n      }\n    ).reduce(mergeGatsbyConfig, {})\n\n    config = mergeGatsbyConfig(themesConfig, config)\n  }\n\n  if (config && config.polyfill) {\n    report.warn(\n      `Support for custom Promise polyfills has been removed in Gatsby v2. We only support Babel 7's new automatic polyfilling behavior.`\n    )\n  }\n\n  store.dispatch({\n    type: `SET_SITE_CONFIG`,\n    payload: config,\n  })\n\n  activity.end()\n\n  activity = report.activityTimer(`load plugins`)\n  activity.start()\n  const flattenedPlugins = await loadPlugins(config)\n  activity.end()\n\n  // onPreInit\n  activity = report.activityTimer(`onPreInit`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`onPreInit`, { parentSpan: activity.span })\n  activity.end()\n\n  // Delete html and css files from the public directory as we don't want\n  // deleted pages and styles from previous builds to stick around.\n  activity = report.activityTimer(\n    `delete html and css files from previous builds`,\n    {\n      parentSpan: bootstrapSpan,\n    }\n  )\n  activity.start()\n  await del([\n    `public/*.{html,css}`,\n    `public/**/*.{html,css}`,\n    `!public/static`,\n    `!public/static/**/*.{html,css}`,\n  ])\n  activity.end()\n\n  activity = report.activityTimer(`initialize cache`)\n  activity.start()\n  // Check if any plugins have been updated since our last run. If so\n  // we delete the cache is there's likely been changes\n  // since the previous run.\n  //\n  // We do this by creating a hash of all the version numbers of installed\n  // plugins, the site's package.json, gatsby-config.js, and gatsby-node.js.\n  // The last, gatsby-node.js, is important as many gatsby sites put important\n  // logic in there e.g. generating slugs for custom pages.\n  const pluginVersions = flattenedPlugins.map(p => p.version)\n  const hashes = await Promise.all([\n    md5File(`package.json`),\n    Promise.resolve(\n      md5File(`${program.directory}/gatsby-config.js`).catch(() => {})\n    ), // ignore as this file isn't required),\n    Promise.resolve(\n      md5File(`${program.directory}/gatsby-node.js`).catch(() => {})\n    ), // ignore as this file isn't required),\n  ])\n  const pluginsHash = crypto\n    .createHash(`md5`)\n    .update(JSON.stringify(pluginVersions.concat(hashes)))\n    .digest(`hex`)\n  let state = store.getState()\n  const oldPluginsHash = state && state.status ? state.status.PLUGINS_HASH : ``\n\n  // Check if anything has changed. If it has, delete the site's .cache\n  // directory and tell reducers to empty themselves.\n  //\n  // Also if the hash isn't there, then delete things just in case something\n  // is weird.\n  if (oldPluginsHash && pluginsHash !== oldPluginsHash) {\n    report.info(report.stripIndent`\n      One or more of your plugins have changed since the last time you ran Gatsby. As\n      a precaution, we're deleting your site's cache to ensure there's not any stale\n      data\n    `)\n  }\n\n  if (!oldPluginsHash || pluginsHash !== oldPluginsHash) {\n    try {\n      await fs.remove(`${program.directory}/.cache`)\n    } catch (e) {\n      report.error(`Failed to remove .cache files.`, e)\n    }\n    // Tell reducers to delete their data (the store will already have\n    // been loaded from the file system cache).\n    store.dispatch({\n      type: `DELETE_CACHE`,\n    })\n  }\n\n  // Update the store with the new plugins hash.\n  store.dispatch({\n    type: `UPDATE_PLUGINS_HASH`,\n    payload: pluginsHash,\n  })\n\n  // Now that we know the .cache directory is safe, initialize the cache\n  // directory.\n  await fs.ensureDir(`${program.directory}/.cache`)\n\n  // Ensure the public/static directory\n  await fs.ensureDir(`${program.directory}/public/static`)\n\n  activity.end()\n\n  // Copy our site files to the root of the site.\n  activity = report.activityTimer(`copy gatsby files`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  const srcDir = `${__dirname}/../../cache-dir`\n  const siteDir = `${program.directory}/.cache`\n  const tryRequire = `${__dirname}/../utils/test-require-error.js`\n  try {\n    await fs.copy(srcDir, siteDir, {\n      clobber: true,\n    })\n    await fs.copy(tryRequire, `${siteDir}/test-require-error.js`, {\n      clobber: true,\n    })\n    await fs.ensureDirSync(`${program.directory}/.cache/json`)\n\n    // Ensure .cache/fragments exists and is empty. We want fragments to be\n    // added on every run in response to data as fragments can only be added if\n    // the data used to create the schema they're dependent on is available.\n    await fs.emptyDir(`${program.directory}/.cache/fragments`)\n  } catch (err) {\n    report.panic(`Unable to copy site files to .cache`, err)\n  }\n\n  // Find plugins which implement gatsby-browser and gatsby-ssr and write\n  // out api-runners for them.\n  const hasAPIFile = (env, plugin) => {\n    // The plugin loader has disabled SSR APIs for this plugin. Usually due to\n    // multiple implementations of an API that can only be implemented once\n    if (env === `ssr` && plugin.skipSSR === true) return undefined\n\n    const envAPIs = plugin[`${env}APIs`]\n\n    // Always include the site's gatsby-browser.js if it exists as it's\n    // a handy place to include global styles and other global imports.\n    try {\n      if (env === `browser` && plugin.name === `default-site-plugin`) {\n        return slash(\n          require.resolve(path.join(plugin.resolve, `gatsby-${env}`))\n        )\n      }\n    } catch (e) {\n      // ignore\n    }\n\n    if (envAPIs && Array.isArray(envAPIs) && envAPIs.length > 0) {\n      return slash(path.join(plugin.resolve, `gatsby-${env}`))\n    }\n    return undefined\n  }\n\n  const ssrPlugins = _.filter(\n    flattenedPlugins.map(plugin => {\n      return {\n        resolve: hasAPIFile(`ssr`, plugin),\n        options: plugin.pluginOptions,\n      }\n    }),\n    plugin => plugin.resolve\n  )\n\n  const browserPlugins = _.filter(\n    flattenedPlugins.map(plugin => {\n      return {\n        resolve: hasAPIFile(`browser`, plugin),\n        options: plugin.pluginOptions,\n      }\n    }),\n    plugin => plugin.resolve\n  )\n\n  const browserPluginsRequires = browserPlugins\n    .map(\n      plugin =>\n        `{\n      plugin: require('${plugin.resolve}'),\n      options: ${JSON.stringify(plugin.options)},\n    }`\n    )\n    .join(`,`)\n\n  const browserAPIRunner = `module.exports = [${browserPluginsRequires}]\\n`\n\n  let sSRAPIRunner = ``\n\n  try {\n    sSRAPIRunner = fs.readFileSync(`${siteDir}/api-runner-ssr.js`, `utf-8`)\n  } catch (err) {\n    report.panic(`Failed to read ${siteDir}/api-runner-ssr.js`, err)\n  }\n\n  const ssrPluginsRequires = ssrPlugins\n    .map(\n      plugin =>\n        `{\n      plugin: require('${plugin.resolve}'),\n      options: ${JSON.stringify(plugin.options)},\n    }`\n    )\n    .join(`,`)\n  sSRAPIRunner = `var plugins = [${ssrPluginsRequires}]\\n${sSRAPIRunner}`\n\n  fs.writeFileSync(\n    `${siteDir}/api-runner-browser-plugins.js`,\n    browserAPIRunner,\n    `utf-8`\n  )\n  fs.writeFileSync(`${siteDir}/api-runner-ssr.js`, sSRAPIRunner, `utf-8`)\n\n  activity.end()\n  /**\n   * Start the main bootstrap processes.\n   */\n\n  // onPreBootstrap\n  activity = report.activityTimer(`onPreBootstrap`)\n  activity.start()\n  await apiRunnerNode(`onPreBootstrap`)\n  activity.end()\n\n  // Source nodes\n  activity = report.activityTimer(`source and transform nodes`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../utils/source-nodes`)({ parentSpan: activity.span })\n  activity.end()\n\n  // Create Schema.\n  activity = report.activityTimer(`building schema`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../schema`).build({ parentSpan: activity.span })\n  activity.end()\n\n  // Collect resolvable extensions and attach to program.\n  const extensions = [`.mjs`, `.js`, `.jsx`, `.wasm`, `.json`]\n  // Change to this being an action and plugins implement `onPreBootstrap`\n  // for adding extensions.\n  const apiResults = await apiRunnerNode(`resolvableExtensions`, {\n    traceId: `initial-resolvableExtensions`,\n    parentSpan: bootstrapSpan,\n  })\n\n  store.dispatch({\n    type: `SET_PROGRAM_EXTENSIONS`,\n    payload: _.flattenDeep([extensions, apiResults]),\n  })\n\n  const graphqlRunner = (query, context = {}) => {\n    const schema = store.getState().schema\n    return graphql(schema, query, context, context, context)\n  }\n\n  // Collect pages.\n  activity = report.activityTimer(`createPages`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`createPages`, {\n    graphql: graphqlRunner,\n    traceId: `initial-createPages`,\n    waitForCascadingActions: true,\n    parentSpan: activity.span,\n  })\n  activity.end()\n\n  // A variant on createPages for plugins that want to\n  // have full control over adding/removing pages. The normal\n  // \"createPages\" API is called every time (during development)\n  // that data changes.\n  activity = report.activityTimer(`createPagesStatefully`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`createPagesStatefully`, {\n    graphql: graphqlRunner,\n    traceId: `initial-createPagesStatefully`,\n    waitForCascadingActions: true,\n    parentSpan: activity.span,\n  })\n  activity.end()\n\n  activity = report.activityTimer(`onPreExtractQueries`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`onPreExtractQueries`, { parentSpan: activity.span })\n  activity.end()\n\n  // Update Schema for SitePage.\n  activity = report.activityTimer(`update schema`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../schema`).build({ parentSpan: activity.span })\n  activity.end()\n\n  require(`../schema/type-conflict-reporter`).printConflicts()\n\n  // Extract queries\n  activity = report.activityTimer(`extract queries from components`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await extractQueries()\n  activity.end()\n\n  // Start the createPages hot reloader.\n  if (process.env.NODE_ENV !== `production`) {\n    require(`./page-hot-reloader`)(graphqlRunner)\n  }\n\n  // Run queries\n  activity = report.activityTimer(`run graphql queries`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  const startQueries = process.hrtime()\n  queryQueue.on(`task_finish`, () => {\n    const stats = queryQueue.getStats()\n    activity.setStatus(\n      `${stats.total}/${stats.peak} ${(\n        stats.total / convertHrtime(process.hrtime(startQueries)).seconds\n      ).toFixed(2)} queries/second`\n    )\n  })\n  await runInitialQueries(activity)\n  activity.end()\n\n  // Write out files.\n  activity = report.activityTimer(`write out page data`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  try {\n    await writePages()\n  } catch (err) {\n    report.panic(`Failed to write out page data`, err)\n  }\n  activity.end()\n\n  // Write out redirects.\n  activity = report.activityTimer(`write out redirect data`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await writeRedirects()\n  activity.end()\n\n  const checkJobsDone = _.debounce(resolve => {\n    const state = store.getState()\n    if (state.jobs.active.length === 0) {\n      report.log(``)\n      report.info(`bootstrap finished - ${process.uptime()} s`)\n      report.log(``)\n\n      // onPostBootstrap\n      activity = report.activityTimer(`onPostBootstrap`, {\n        parentSpan: bootstrapSpan,\n      })\n      activity.start()\n      apiRunnerNode(`onPostBootstrap`, { parentSpan: activity.span }).then(\n        () => {\n          activity.end()\n          bootstrapSpan.finish()\n          resolve({ graphqlRunner })\n        }\n      )\n    }\n  }, 100)\n\n  if (store.getState().jobs.active.length === 0) {\n    // onPostBootstrap\n    activity = report.activityTimer(`onPostBootstrap`, {\n      parentSpan: bootstrapSpan,\n    })\n    activity.start()\n    await apiRunnerNode(`onPostBootstrap`, { parentSpan: activity.span })\n    activity.end()\n\n    bootstrapSpan.finish()\n\n    report.log(``)\n    report.info(`bootstrap finished - ${process.uptime()} s`)\n    report.log(``)\n    emitter.emit(`BOOTSTRAP_FINISHED`)\n    return {\n      graphqlRunner,\n    }\n  } else {\n    return new Promise(resolve => {\n      // Wait until all side effect jobs are finished.\n      emitter.on(`END_JOB`, () => checkJobsDone(resolve))\n    })\n  }\n}\n"],"file":"index.js"}