{"componentChunkName":"component---src-templates-category-js","path":"/categories/Gatsby/","webpackCompilationHash":"be161c4017b1db4ff602","result":{"data":{"allMarkdownRemark":{"nodes":[{"html":"<p>TL;DR Check out the <a href=\"#fragment1\">Bulk Requests and pageContext</a> section below to learn how pageContext works.</p>\n<p><a href=\"https://www.gatsbyjs.org/\">Gatsby</a> has become the de facto JavaScript static site generator because of its dedication to performance, near-infinite flexibility, and its embrace of React and GraphQL. Like any great tool, however, Gatsby is not without flaws.</p>\n<p>Gatsby allows you to build your static website by querying a GraphQL API at build time. If you choose this approach, as your site grows, your Gatsby build times will likely increase with every added page. Slow build times hinder developer workflows and make deployments cumbersome. In my <a href=\"/a-performance-guide-to-gatsbyjs\">previous article</a>, I discussed optimizing GraphQL queries in Gatsby to decrease page load times. This article will focus on how GraphQL queries can be optimized to shorten ten minute or even hour-long build times to seconds.</p>\n<!-- more -->\n<h2>Gatsby Templates</h2>\n<p>The typical Gatsby site has a template for each page type. For example, you might have a page for each product your site sells and a single template to generate these pages.</p>\n<p>Each template has two pieces:</p>\n<ol>\n<li>A React Component</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Product</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      Name: </span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      Price: </span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>price<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      Description: </span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The HTML outputted by this React component determines the contents of each product page on your site.</p>\n<ol start=\"2\">\n<li>A GraphQL Query</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"gatsby\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> query <span class=\"token operator\">=</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  query Product($productId: String!) {\n    GetProduct(id: $productId) {\n      name\n      price\n      description\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This GraphQL query will run at build time, and the results will be accessible in the <code class=\"language-text\">data</code> prop of the above component.</p>\n<p>Together, these two pieces comprise your template file and will likely be located at <code class=\"language-text\">src/templates/product.js</code></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// src/templates/product.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"gatsby\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Product</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      Name: </span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      Price: </span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>price<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      Description: </span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> query <span class=\"token operator\">=</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  query Product($productId: String!) {\n    GetProduct(id: $productId) {\n      name\n      price\n      description\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>You be wondering where the query gets run, where the component is used, and how the <code class=\"language-text\">$productId</code> query parameter is defined. Let's dive into the <code class=\"language-text\">gatsby-node.js</code> file.</p>\n<h2>The gatsby-node.js File</h2>\n<p>Every Gatsby project has a <code class=\"language-text\">gatsby-node.js</code> file at its root. This file gives you access to a wide range of <a href=\"https://www.gatsbyjs.org/docs/node-apis/\">hooks</a> and <a href=\"https://www.gatsbyjs.org/docs/actions/\">APIs</a> (called actions) that let you customize the bones of your application. In fact, this is the exact same API that Gatsby plugins use under the hood.</p>\n<p>We're interested in a hook called <code class=\"language-text\">createPages</code>. This hook will run during Gatsby's build and will allow us to specify which pages we want to create with the above template. Let's explore this through an example:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// gatsby-node.js</span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> graphql<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createPage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Gatsby gives us access to a GraphQL client that we can</span>\n  <span class=\"token comment\">// use to query any GraphQL API.</span>\n  <span class=\"token comment\">// Make a query to our server to get all the product ids</span>\n  <span class=\"token comment\">// in our database</span>\n  <span class=\"token keyword\">const</span> queryResults <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    query AllProducts {\n      AllProducts {\n        nodes {\n          id\n        }\n      }\n    }\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> productTemplate <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">src/templates/product.js</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Create a page for every single product ID</span>\n  queryResults<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>allProducts<span class=\"token punctuation\">.</span>nodes<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">node</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      path<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/products/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>node<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// The URL where this particular page will live</span>\n      component<span class=\"token punctuation\">:</span> productTemplate<span class=\"token punctuation\">,</span> <span class=\"token comment\">// The template whose component and query define this page's HTML</span>\n      context<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Query parameters passed to productTemplate's GraphQL query</span>\n        productId<span class=\"token punctuation\">:</span> node<span class=\"token punctuation\">.</span>id\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The above code will run every time you build your website. It performs a handful of steps:</p>\n<ol>\n<li>Query your server to find all the product IDs</li>\n<li>Retrieve the product template defined above</li>\n<li>Create a page for every product</li>\n</ol>\n<p>Note:</p>\n<ul>\n<li>Each page will have a url like <code class=\"language-text\">/product/55</code>, where 55 is the id of the product.</li>\n<li>We pass in the <code class=\"language-text\">productId</code> as <code class=\"language-text\">context</code>. You can think of <code class=\"language-text\">context</code> as the set of arguments passed to the GraphQL query associated with this template.</li>\n</ul>\n<p>Behind the scenes, <code class=\"language-text\">createPage</code> will execute the template's GraphQL query once per product. If you have a lot of products, this behavior can lead to performance problems.</p>\n<h2>Performance Issues</h2>\n<p>This strategy shows its warts in two scenarios:</p>\n<ol>\n<li>If your GraphQL query is expensive and you have a lot of pages, you will repeat this query once for every page for potentially thousands of pages.</li>\n<li>If two different templates make expensive queries for the same data</li>\n</ol>\n<p>Both of these scenarios can severely affect build times. Fortunately, there is a workaround.</p>\n<p><a name=\"fragment1\"></a></p>\n<h2>Bulk Requests and pageContext</h2>\n<p>The crux of our problem is that we are repeating similar queries many times. One strategy to solve this issue is to request the data in bulk. Suppose we adjusted the <code class=\"language-text\">gatsby-node</code> file's query:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// gatsby-node.js</span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> graphql<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createPage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Query for all the data needed by every product page</span>\n  <span class=\"token comment\">// in a single HTTP request.</span>\n  <span class=\"token keyword\">const</span> queryResults <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    query AllProducts {\n      AllProducts {\n        nodes {\n          id\n          name\n          price\n          description\n        }\n      }\n    }\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We are now requesting all of the data we need in a single query (this requires server-side support to fetch many products in a single database query). As long as we can pass this data down to our template's component, there is no need for the template to make a GraphQL query at all.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// gatsby-node.js</span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> graphql<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createPage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> queryResults <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    query AllProducts {\n      allProducts {\n        nodes {\n          id\n          name\n          price\n          description\n        }\n      }\n    }\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> productTemplate <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">src/templates/product.js</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  queryResults<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>allProducts<span class=\"token punctuation\">.</span>nodes<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">node</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      path<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/products/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>node<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      component<span class=\"token punctuation\">:</span> productTemplate<span class=\"token punctuation\">,</span>\n      context<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// This time we pass down the entire product as context</span>\n        product\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It turns out that <code class=\"language-text\">context</code> serves more than one purpose. Above we saw how it defines a template's query arguments; this data is also passed <strong>directly</strong> to the template component as a prop called <code class=\"language-text\">pageContext</code>.</p>\n<p>Our component can be adjusted to use this prop:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// src/templates/product.js</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Product</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> pageContext <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      Name: </span><span class=\"token punctuation\">{</span>pageContext<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      Price: </span><span class=\"token punctuation\">{</span>pageContext<span class=\"token punctuation\">.</span>price<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      Description: </span><span class=\"token punctuation\">{</span>pageContext<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Tradeoffs</h2>\n<p>This alternative approach can drastically improve performance, but it also has downsides. In fact, for the average application, the Gatsby maintainers recommend against this approach.</p>\n<p>The moment we start using <code class=\"language-text\">pageContext</code> is the moment we stop colocating our template components along with their associated GraphQL queries. You will notice that our <code class=\"language-text\">src/templates/product.js</code> file doesn't have a GraphQL query anymore (it could, if we wanted to query additional data from a more performant endpoint). This has two downsides:</p>\n<ol>\n<li>\n<p>It's not immediately obvious anymore what the props of the <code class=\"language-text\">Product</code> component are. In our simple example, this is less of a problem, but in large production applications, it has a huge effect on readability and maintainability</p>\n<ul>\n<li>This issue can be somewhat mitigated with <a href=\"https://www.typescriptlang.org/docs/handbook/interfaces.html\">TypeScript interfaces</a> or <a href=\"https://www.npmjs.com/package/prop-types\">React PropTypes</a>, but there is still an opportunity for these definitions to drift from the data actually passed in.</li>\n</ul>\n</li>\n<li>Components are usually hot reloaded when their associated GraphQL queries change. Now, when we change our query (located in the <code class=\"language-text\">gatsby-node</code> file), our website needs to be rebuilt.</li>\n</ol>\n<h2>Conclusion</h2>\n<p>Only resort to <code class=\"language-text\">pageContext</code> only when absolutely necessary. Do not use this performance optimization prematurely (before you experience a performance problem) because it only will impair the readability of your code. When your builds get slow, however, this technique can mean the difference between unacceptable build times and a smooth experience.</p>","excerpt":"<p>TL;DR Check out the <a href=\"#fragment1\">Bulk Requests and pageContext</a> section below to learn how pageContext works.</p>\n<p><a href=\"https://www.gatsbyjs.org/\">Gatsby</a> has become the de facto JavaScript static site generator because of its dedication to performance, near-infinite flexibility, and its embrace of React and GraphQL. Like any great tool, however, Gatsby is not without flaws.</p>\n<p>Gatsby allows you to build your static website by querying a GraphQL API at build time. If you choose this approach, as your site grows, your Gatsby build times will likely increase with every added page. Slow build times hinder developer workflows and make deployments cumbersome. In my <a href=\"/a-performance-guide-to-gatsbyjs\">previous article</a>, I discussed optimizing GraphQL queries in Gatsby to decrease page load times. This article will focus on how GraphQL queries can be optimized to shorten ten minute or even hour-long build times to seconds.</p>\n","frontmatter":{"title":"Optimizing Gatsby Build Times for Large Websites Using pageContext","date":"2019-08-26T00:00:00.000Z","url":"optimizing-gatsby-build-times-for-large-websites-using-pagecontext"}},{"html":"<p>In my article <a href=\"/hexo-vs-gatsbyjs-comparing-nodejs-static-site-generators\">comparing Gatsby to Hexo</a>, I talked about my experience switching writing this blog using <a href=\"https://hexo.io/\">Hexo</a> and then later using <a href=\"https://www.gatsbyjs.org/\">Gatsby</a>. In the process, the size of my initial page ballooned 5x.</p>\n<p>In retrospect, I did not fully understand the abstraction that Gatsby provides. Fortunately, if you follow a simple rule of thumb, you can avoid bloating your network requests and maintain an ultra-performant website.</p>\n<!-- more -->\n<h2>Process as Much Data with GraphQL as Possible</h2>\n<p>If you walk away learning nothing else, this is the most important point.</p>\n<p>When you build your website, Gatsby will effectively run all of the GraphQL queries needed to load each page and save the resulting JSON. When you visit a given page on your site, requests will be made for these JSON payloads, completely unmodified.</p>\n<p>I originally thought that <code class=\"language-text\">gatsby build</code> would combine my react components and GraphQL requests, transforming them into HTML, resulting in a website that sends strictly HTML over the wire. This is not the case (unless the client has JavaScript disabled)! Here a small piece of the JSON payload for the homepage of my website:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 680px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5e32dfc5d836a1c723e2c61fff4e4061/54f11/json-payload.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.691373025516405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABV0lEQVQoz5VSa2/CMAzk//88kBhdA5TSpq81fdOGJr0lZhEwxodZsuzY51Piy4pzjiiK0LQd9LLA2fImfzRX1nrBJDWmSWElhABjDE3VmQ7BDLF+S+zcYh7PzlYu2ccMwVeAUITGzziVJ/KwDBGUAfVc/2z65yqiaPtHU28uzY3QsfsnH2t/jQM/GMCRgEmdgNcccRVTLLoC9aWm4WqoMMgBSitc1ZXiE2HKU3ifHrImo2FLZoftkPV+6jFeR7MvTcPWf+/WnolQSvnUtPt53ON/jAjHcURaZGiHFvXY0M3asaOn2dx62ZcQ5pnCRPtcMQiKZS9MTRBGzvIuyu64w+awAUsY9sUefu6D5Qxe6pE4do/WIyNG/CPILb/VsjbHrOb7DnnEsf3YIikT5KZpganZp7sdiTDdRJj1TMNOjBdRlFK0bAuSStLVp3kioPtzf4nw+tEXfAODEQShMyuGiAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/5e32dfc5d836a1c723e2c61fff4e4061/fb8f2/json-payload.webp 170w,\n/static/5e32dfc5d836a1c723e2c61fff4e4061/a7e55/json-payload.webp 340w,\n/static/5e32dfc5d836a1c723e2c61fff4e4061/4a434/json-payload.webp 680w,\n/static/5e32dfc5d836a1c723e2c61fff4e4061/18e42/json-payload.webp 1020w,\n/static/5e32dfc5d836a1c723e2c61fff4e4061/bdd6f/json-payload.webp 1360w,\n/static/5e32dfc5d836a1c723e2c61fff4e4061/7bdd9/json-payload.webp 1646w\"\n          sizes=\"(max-width: 680px) 100vw, 680px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/5e32dfc5d836a1c723e2c61fff4e4061/924ad/json-payload.png 170w,\n/static/5e32dfc5d836a1c723e2c61fff4e4061/6103d/json-payload.png 340w,\n/static/5e32dfc5d836a1c723e2c61fff4e4061/5e3e6/json-payload.png 680w,\n/static/5e32dfc5d836a1c723e2c61fff4e4061/89b07/json-payload.png 1020w,\n/static/5e32dfc5d836a1c723e2c61fff4e4061/2f8d2/json-payload.png 1360w,\n/static/5e32dfc5d836a1c723e2c61fff4e4061/54f11/json-payload.png 1646w\"\n          sizes=\"(max-width: 680px) 100vw, 680px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/5e32dfc5d836a1c723e2c61fff4e4061/5e3e6/json-payload.png\"\n          alt=\"JSON payload for the homepage website\"\n          title=\"JSON payload for the homepage website\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>So what does this mean for you?</p>\n<ol>\n<li>Do not request data that you don't need. This rule of thumb is obvious in a typical Single Page Application, but it applies here too. We want to minimize the size of our HTTP responses.</li>\n<li>If you can do <a href=\"https://www.gatsbyjs.org/docs/graphql-reference/\">filtering, sorting, or limiting in GraphQL</a>, do it there instead of at the application layer.</li>\n</ol>\n<p>The second points bears explanation. Here are two functionally equivalent chunks of code to grab the html of the 5 most recent posts.</p>\n<h2>Post-Processing GraphQL results with JavaScript</h2>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  allMarkdownRemark <span class=\"token punctuation\">{</span>\n    edges <span class=\"token punctuation\">{</span>\n      node <span class=\"token punctuation\">{</span>\n        html\n        frontmatter <span class=\"token punctuation\">{</span>\n          date\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Assuming data is the result of the above GraphQL query</span>\n<span class=\"token keyword\">const</span> mostRecentPosts <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>allMarkdownRemark<span class=\"token punctuation\">.</span>edges\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">edge</span> <span class=\"token operator\">=></span> edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// Sort each post by dates in reverse chronological order</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">node1<span class=\"token punctuation\">,</span> node2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> a <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>node1<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> b <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>node2<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> a <span class=\"token operator\">></span> b <span class=\"token operator\">?</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token punctuation\">:</span> a <span class=\"token operator\">&lt;</span> b <span class=\"token operator\">?</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// Grab the 5 most recent ones</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Everything in GraphQL</h2>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  allMarkdownRemark<span class=\"token punctuation\">(</span>\n    <span class=\"token attr-name\">limit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n    <span class=\"token attr-name\">sort</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">fields</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>frontmatter___date<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">order</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">DESC</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    edges <span class=\"token punctuation\">{</span>\n      node <span class=\"token punctuation\">{</span>\n        html\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I was initially uncomfortable with GraphQL and coded everything in the former style, making broad GraphQL queries and later performing additional processing using JavaScript. This strategy has numerous problems.</p>\n<ol>\n<li>As I mentioned above, instead of grabbing the html of just 5 posts, we are grabbing it for every post. This translates directly into what is sent over the wire when someone loads the page, bloating the site. To compound the problem, the performance hit grows with every single post we add to our site.</li>\n<li>Not only am I grabbing more posts than I need, every post includes additional information. Notice in the second example that we don't need to query the date because sorting is handled by GraphQL.</li>\n<li>Lastly, the second example is so much more readable</li>\n</ol>\n<h2>Conclusion</h2>\n<p>Gatsby is a powerful static site generator, though it's not immediately obvious how your code influences the resulting site's performance. You can make great strides, however, if you always offload as much work onto GraphQL as possible.</p>","excerpt":"<p>In my article <a href=\"/hexo-vs-gatsbyjs-comparing-nodejs-static-site-generators\">comparing Gatsby to Hexo</a>, I talked about my experience switching writing this blog using <a href=\"https://hexo.io/\">Hexo</a> and then later using <a href=\"https://www.gatsbyjs.org/\">Gatsby</a>. In the process, the size of my initial page ballooned 5x.</p>\n<p>In retrospect, I did not fully understand the abstraction that Gatsby provides. Fortunately, if you follow a simple rule of thumb, you can avoid bloating your network requests and maintain an ultra-performant website.</p>\n","frontmatter":{"title":"One Simple Performance Tip to Optimize GatsbyJS Static Sites","date":"2018-12-13T00:00:00.000Z","url":"a-performance-guide-to-gatsbyjs"}},{"html":"<p>There are two major <a href=\"https://davidwalsh.name/introduction-static-site-generators\">static site generators</a> in the JavaScript ecosystem: the incumbent <a href=\"https://hexo.io\">Hexo</a> and the up-and-coming <a href=\"https://www.gatsbyjs.org/\">Gatsby</a>. This site was first built with Hexo, but I've recently switched to Gatsby. Let's talk about why.</p>\n<!-- more -->\n<h2>Different Products</h2>\n<p>First, let's talk high level. Hexo and Gatsby both generate static websites, but at their hearts, they are very different products. Hexo is a blog generator; Gatsby is a generalized static site generator. Let me elaborate.</p>\n<h3>Hexo</h3>\n<p>Hexo specializes in creating markup (be it <a href=\"https://en.wikipedia.org/wiki/Markdown\">markdown</a> or <a href=\"https://en.wikipedia.org/wiki/ReStructuredText\">reStructuredText</a>) driven blogs. This specialization comes with tradeoffs. It's simple to get a blog up and running, but if you want to do anything more complicated, it ranges from challenging to impossible. This limitation might not restrict you, however.</p>\n<h3>Gatsby</h3>\n<p>Gatsby epitomizes customizability and allows for the creation of arbitrarily complex static sites, ranging from simple blogs to fully featured e-commerce websites. It provides <a href=\"https://www.gatsbyjs.org/docs/node-apis/\">an API</a> for you to build and query a <a href=\"https://graphql.org/\">GraphQL</a> API composed of data from a variety of sources. You can then dynamically compose your static website based on the results of your queries. Gatsby trades power for complexity, requiring users to learn some new tools to leverage its capabilities.</p>\n<p>Let's get into the nitty gritty details.</p>\n<h2>Getting Up and Running</h2>\n<p>Both platforms make it easy to get from <code class=\"language-text\">yarn install</code> to writing blog articles, though Hexo definitely excels in this regard.</p>\n<h3>Hexo</h3>\n<p>With Hexo, I was able to install the application, run a couple <a href=\"https://hexo.io/docs/setup\">configuration commands</a>, pick a <a href=\"https://hexo.io/themes/index.html\">theme from their website</a>, and start writing.</p>\n<h3>Gatsby</h3>\n<p>Gatsby's sheer volume of documentation made the setup process slightly more challenging, though hardly difficult. There are two places you can start: their <a href=\"https://www.gatsbyjs.org/docs/\">getting started page</a> or <a href=\"https://www.gatsbyjs.org/tutorial/\">their tutorial</a>. The former will link you to their <a href=\"https://www.gatsbyjs.org/starters/?v=2\">starter library</a> and will help you get a server up and running. The latter will teach you how to customize your website.</p>\n<h2>Developer Experience</h2>\n<p>Hexo does not provide any tooling out-of-the-box, and your experience is largely determined by your theme. Gatsby, in contrast, optimizes for developer productivity.</p>\n<h3>Hexo</h3>\n<p>When I began with Hexo, I picked a theme called <a href=\"https://github.com/hmybmny/hexo-theme-concise\">Concise</a>, and my experience mostly stems from customizing this theme. Hexo originally only supported a dated templating language called <a href=\"https://ejs.co/\">EJS</a>, and most themes including Concise use it. Here is some sample code from Concise.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 680px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f97f98761f9e68564060ccfd117dae13/79997/concise-code.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.626780626780626%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAA6klEQVQY052QwVLEIBBE9/+/Uje7iQkJLIQAgSXPIepBq/RgV/UUHKZ59CXEiNcaM89cu477/YZSM/sa0NqRlgWeT4q4iqmV33QcB5c2inP0146X1zvdtWfoNf3NYIY34jhi+kEeuzHKPT0sDWLfd/ZcCSlTcz7Dmi5tPEPAqwUzeZxJPB4bs7HilS1EIdU4azHG4FbPpBROgu1WmBZHWd33wOI3YkrU6Bs4/9XHl9shBqLPQlHEEaUtw6RRixWijSyVHNJdW/jLJ2EVsm1e8MOEHTWr0nghXn2UrhI5l7Mj2tInxRfNz7Cmd/s30vXaFhfWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/f97f98761f9e68564060ccfd117dae13/fb8f2/concise-code.webp 170w,\n/static/f97f98761f9e68564060ccfd117dae13/a7e55/concise-code.webp 340w,\n/static/f97f98761f9e68564060ccfd117dae13/4a434/concise-code.webp 680w,\n/static/f97f98761f9e68564060ccfd117dae13/b05fc/concise-code.webp 702w\"\n          sizes=\"(max-width: 680px) 100vw, 680px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/f97f98761f9e68564060ccfd117dae13/924ad/concise-code.png 170w,\n/static/f97f98761f9e68564060ccfd117dae13/6103d/concise-code.png 340w,\n/static/f97f98761f9e68564060ccfd117dae13/5e3e6/concise-code.png 680w,\n/static/f97f98761f9e68564060ccfd117dae13/79997/concise-code.png 702w\"\n          sizes=\"(max-width: 680px) 100vw, 680px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/f97f98761f9e68564060ccfd117dae13/5e3e6/concise-code.png\"\n          alt=\"Code sample from Concise\"\n          title=\"Code sample from Concise\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>Apart from the obvious readability problems, the syntax is challenging to edit and thus is at odds with application discoverability. It makes trivial exercises like console logging error-prone. Furthermore, the syntax is incompatible with the modern formatting tool, <a href=\"https://prettier.io/\">Prettier</a>.</p>\n<p>Today Hexo supports other templating languages, but it's a shame so many themes are tightly coupled to such an unergonomic tool.</p>\n<h3>Gatsby</h3>\n<p>Gatsby emphasizes the developer experience, using <a href=\"https://reactjs.org/\">React</a> and <a href=\"https://graphql.org/\">GraphQL</a> as the foundation for every Gatsby application. These tools and their ecosystems were immediate productivity boosters for me, though they do have a non-trivial learning curve. Fortunately, the Gatsby docs assume no prior knowledge, and realistically, you only need minimal understanding to be productive.</p>\n<p>The aforementioned <a href=\"https://www.gatsbyjs.org/docs/node-apis/\">Gatsby API</a>, which is used the define the pages of your site (among other things), also requires study to understand. It's powerful but lacks detailed documentation. Use cases for the various methods and hooks are scattered throughout the docs, though I was able to supplement the documentation with blogs/tutorials such that learning the API was manageable.</p>\n<p>Gatsby also automatically configures numerous developer tools to optimize your productivity. For example, <a href=\"https://github.com/graphql/graphiql\">GraphiQL</a> (more on this later) allows you to explore your data sources, Prettier ensures that your code remains consistently formatted, hot-reloading updates your UI without refreshing, and <a href=\"https://eslint.org/\">ESlint</a> catches your mistakes.</p>\n<p>Behind the scenes, Gatsby configures <a href=\"https://webpack.js.org/\">webpack</a> for you, abstracting away the most challenging parts of the React ecosystem. It goes to extra mile and things like service workers, inlining critical CSS, and CSS modules are automatic or a plugin away. Here is an exhaustive list of its <a href=\"https://www.gatsbyjs.org/features/\">features</a>.</p>\n<h2>Documentation</h2>\n<p>Documentation can make or break a developer's experience, and Hexo and Gatsby approach documentation very differently.</p>\n<h3>Hexo</h3>\n<p>Hexo does a great job of ensuring you need to read as little text as possible to get a blog up and running. If you want to customize your blog, however, the documentation's previously appreciated brevity shows it's warts. I would often read a page and have no idea what I was looking at, even when it was exactly what I needed.</p>\n<p>For example, if you want to customize your theme, you will need to know what variables Hexo injects into your template engine's rendering system. This <a href=\"https://hexo.io/docs/variables.html\">site</a> provides the details but doesn't provide an overview explaining its purpose.</p>\n<p>I should provide one qualifying statement. Hexo augments its documentation with video tutorials. I never noticed them until I chose to write this article, but perhaps they provide the detail I previously yearned for.</p>\n<h3>Gatsby</h3>\n<p>Gatsby's documentation is thoughtful, well-organized, and detailed. It has everything from <a href=\"https://www.gatsbyjs.org/tutorial/\">tutorials</a> to deep dives <a href=\"https://www.gatsbyjs.org/docs/adding-images-fonts-files/\">1</a>, <a href=\"https://www.gatsbyjs.org/docs/creating-and-modifying-pages/\">2</a>, <a href=\"https://www.gatsbyjs.org/docs/styling/\">3</a>. It even has pages explaining and justifying <a href=\"https://www.gatsbyjs.org/docs/behind-the-scenes/\">architecture and implementation details</a>. And to top all this off, it has a <a href=\"https://www.gatsbyjs.org/docs/gatsby-style-guide/\">style guide</a> to ensure readability.</p>\n<p>With all this said, there are still <a href=\"https://www.gatsbyjs.org/docs/dropping-images-into-static-folders/\">placeholder pages</a>, though I never found myself unable to answer a question about their system.</p>\n<h2>API Discoverability</h2>\n<p>A static site generator needs to make it easy to edit your website. One of the first requirements to editing your site is understanding the data structures the static site generator makes available to you.</p>\n<h3>Hexo</h3>\n<p>Hexo documents its data structures in the <a href=\"https://hexo.io/docs/variables.html\">link mentioned above</a>. The page references many key topics but never elaborates. I remember agonizing over providing support for both pagination and article excerpts.</p>\n<p>The page seems to hint that the next and previous blog posts are available from their API, though the fields were always <code class=\"language-text\">undefined</code>. I never figured out why.</p>\n<p>It also suggests excerpts are available. It wasn't until I discovered this <a href=\"https://github.com/hexojs/hexo/issues/1143\">GitHub issue</a> that I learned it's required to add the comment <code class=\"language-text\">&lt;!-- more --&gt;</code> to each post to ensure that this excerpt is populated. This feature is otherwise undocumented.</p>\n<p>Moreover, EJS prevents rapid code changes and thus data structure exploration, exacerbating these documentation problems.</p>\n<h3>Gatsby</h3>\n<p>Gatsby solves the problem of discoverability with <a href=\"https://github.com/graphql/graphiql\">GraphiQL</a>. It automatically spins up a GraphiQL server which allows you to interactively browse your data. Here is a simple example that queries article excerpts and titles:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 680px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/88d7a264299e94fd26d656e6c241040e/a1f82/graphiql.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.89256198347107%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB+0lEQVQ4y41T6XLyMBDjjYAkju8zB5Qe833v/zCq7EALnenxQ8PGeDWSdr2b5wUpZ5RSGjLrEAJSjPA+tDqyrkgptm9rDLxV8E7BaIV5nlg7jOOIXXIS3kiIocfxeGwQw4BQIuYloUTHywaajTdIqXmvw+Gw3d/v96wPrd4Vr3CZPEYxtEv1cCChoYpzCQ3OaCgSKSWv0FQj0Pc9uq57wK4eOj3yT5J1n4R2jrBrRHku8JcC90pbbzO0N7BVqfHtXnftuWFXD27SuztCNwWYOeBEovXfAveU4c4JOjmYqlJbCDF+9HwovP+4JzTBwhKOBJbQtK2vlp1RsDYwS7U5+wuhVgrBGmRvW62aTf5WMi0htUcvzN8VujXBM7+ZliPhqu2XAkXVSzJ4Yhw+nRvp8Xj4ndByuobTP71MWF7nlmEdUlVYVymGxElzfbr+cSjfEtYM2WiiZZ7bHiq5ZTgFx2wzhBaQgmd2hFCMoB9+yJBDCMyvqtGWA3G6DUoxv6WsKKcLpJshRv+wj79muDC7/J/5PW+7qLNrCk9T5k56SCMw0Hp3tf494bRluDK7iftn+V2nLOWIU+b5tEL5qrBHP4hHwq+oFlqGVKL5jtuzo9Vbjpm5Kpt5lySHz75mWQiBr5CyNmtEkrUM21u+EnIolk9VSksCPr07h5X0Hc578FYsVRseAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/88d7a264299e94fd26d656e6c241040e/fb8f2/graphiql.webp 170w,\n/static/88d7a264299e94fd26d656e6c241040e/a7e55/graphiql.webp 340w,\n/static/88d7a264299e94fd26d656e6c241040e/4a434/graphiql.webp 680w,\n/static/88d7a264299e94fd26d656e6c241040e/18e42/graphiql.webp 1020w,\n/static/88d7a264299e94fd26d656e6c241040e/bdd6f/graphiql.webp 1360w,\n/static/88d7a264299e94fd26d656e6c241040e/72845/graphiql.webp 2420w\"\n          sizes=\"(max-width: 680px) 100vw, 680px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/88d7a264299e94fd26d656e6c241040e/924ad/graphiql.png 170w,\n/static/88d7a264299e94fd26d656e6c241040e/6103d/graphiql.png 340w,\n/static/88d7a264299e94fd26d656e6c241040e/5e3e6/graphiql.png 680w,\n/static/88d7a264299e94fd26d656e6c241040e/89b07/graphiql.png 1020w,\n/static/88d7a264299e94fd26d656e6c241040e/2f8d2/graphiql.png 1360w,\n/static/88d7a264299e94fd26d656e6c241040e/a1f82/graphiql.png 2420w\"\n          sizes=\"(max-width: 680px) 100vw, 680px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/88d7a264299e94fd26d656e6c241040e/5e3e6/graphiql.png\"\n          alt=\"GraphiQL Example\"\n          title=\"GraphiQL Example\"\n          loading=\"lazy\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>You can see the query on the left, the results in the middle, and interactive schema documentation on the right. To top it all off, the environment provides autocomplete and errors messages.</p>\n<p>The contrast with Hexo's variable page is stark.</p>\n<h2>Community</h2>\n<p>A large and active community makes on-boarding easier. It means more people have run into the same problems, which often translates into more tutorials and more stack overflow questions answered. Community quality can heavily influence a developer's experience.</p>\n<h3>Hexo</h3>\n<p>Hexo is the most popular static site generator in the JS ecosystem, though I did not feel like the this made solving problems easier. I had numerous question I had to answer by consulting the source code.</p>\n<p>I think my experiences stems from the fact that Hexo's user base is largely Chinese. Unless your bilingual, this makes potentially helpful documentation and conversations inaccessible.</p>\n<h3>Gatsby</h3>\n<p>I've been blown away by the quality of Gatsby's community so far.</p>\n<p>The maintainers have written tutorials about how to migrate from other blogging platforms, and dedicated community members write about solving their own problems.</p>\n<p>I've also been impressed as a contributor to Gatsby. I ran into an issue where excerpts only rendered in plain text, not HTML. I opened a <a href=\"https://github.com/gatsbyjs/gatsby/pull/9716\">PR</a> to fix this problem and received prompt and thoughtful replies.</p>\n<h2>Plugin Ecosystem</h2>\n<h3>Hexo</h3>\n<p>Hexo has a <a href=\"https://hexo.io/plugins/index.html\">plugin page</a> detailing links to everything from markdown parsers to image and css optimizers. There are 277 plugins available, and I never ran into a situation where I couldn't find a plugin to do what I needed.</p>\n<h3>Gatsby</h3>\n<p>Gatsby has a <a href=\"https://hexo.io/plugins/index.html\">plugin search system</a> with twice as many plugins - 550 to be exact - available to date, though it's not clear to me how much additional value this offers over Hexo.</p>\n<p>On a side note, I appreciated that Gatsby sorts their plugin search results based on number of downloads. This primitive but effective metric makes it easier to evaluate the quality of a given plugin.</p>\n<h2>Performance</h2>\n<p>There are two types of performance relevant to this discussion: the speed of the static site generator itself, and the speed of the website it produces.</p>\n<p>If a static site generator is slow to render your changes, it slows down your development speed. Fortunately, both Hexo and Gatsby refresh changes without perceptible delay.</p>\n<p>The speed of the sites these tools produce varies quite drastically.</p>\n<h3>Hexo</h3>\n<p>With Hexo, the speed of your static site will be completely coupled to your theme. Your theme might load tons of unnecessary JavaScript; it also might not use any.</p>\n<p>The most important point here is that Hexo adds absolutely no overhead to your website. It introduces no additional dependencies into your built project. If you want a pure static site without any JavaScript, you can create that. If you want no page to exceed 40kb, that's entirely doable.</p>\n<h3>Gatsby</h3>\n<p>Gatsby takes a much different approach.</p>\n<p>For starters, it introduces a JavaScript dependency into your web site, clocking in around 65kb. This dependency is larger than any single page on my original Hexo website! Fortunately, Gatsby websites will continue to work on browsers with JavaScript disabled.</p>\n<p>Gatsby either automatically or through plugins applies numerous performance tricks to every website. To explain a few:</p>\n<ol>\n<li>When you reference a style sheet using a <code class=\"language-text\">link</code> tag, the page blocks rendering until the entire roundtrip server request is complete. Gatsby circumvents this problem by inlining critical CSS into your HTML.</li>\n<li>When you visit a page, once it has finished loading, Gatsby will begin loading every page you can reach from the page you're on. This technique is known as prefetching and makes subsequent page loads fast.</li>\n<li>Gatsby does per route code/data splitting. This means that when you go to a page, Gatsby ensures that only the data and JavaScript needed to render that page is passed over the network.</li>\n<li>Gatsby uses <a href=\"https://developers.google.com/web/fundamentals/primers/service-workers/\">service workers</a> via <a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-offline/\">gatsby-plugin-offline</a> to cache all the pages you download. This allows subsequent requests for those pages to hit the cache instead of the network. It also allow for users to browse your page offline later.</li>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-image/\">Gatsby Image</a> preprocesses and calibrates images for various screen sizes. This ensures that high resolution screens get high resolution images and vice-versa, resulting in significant bandwidth savings for smaller screens.</li>\n</ol>\n<p>All of these performance abstractions don't come without a cost. I think my experience was quite telling. When I finished my Hexo website, the main page was ~40kb, whereas when I finished my Gatsby website, the main page was ~134kb, though it's a little difficult to be precise, which brings me to my next point.</p>\n<p>Optimization is initially challenging and opaque with Gatsby. When I started, not only did I have no idea my final site would contain JavaScript, I had no idea what would influence its performance.</p>\n<p>It turns out that everything I returned from my GraphQL queries is loaded at runtime, regardless of whether the site used it. I didn't understand this going in, and it influences <a href=\"/a-performance-guide-to-gatsbyjs\">how I use Gatsby today</a>. This contrasts with Hexo where the performance consequences of my development choices were obvious.</p>\n<h2>Conclusion</h2>\n<p>Hexo are Gatsby are different products. If you're interested in picking a theme, spinning up a blog, and perhaps tweaking it, Hexo might be a simpler choice. If, however, you want flexibility and a productive developer experience, Gatsby overshadows Hexo in nearly every way.</p>","excerpt":"<p>There are two major <a href=\"https://davidwalsh.name/introduction-static-site-generators\">static site generators</a> in the JavaScript ecosystem: the incumbent <a href=\"https://hexo.io\">Hexo</a> and the up-and-coming <a href=\"https://www.gatsbyjs.org/\">Gatsby</a>. This site was first built with Hexo, but I've recently switched to Gatsby. Let's talk about why.</p>\n","frontmatter":{"title":"A Deep Dive into JavaScript Static Site Generators: Gatsby vs. Hexo","date":"2018-11-24T00:00:00.000Z","url":"hexo-vs-gatsbyjs-comparing-nodejs-static-site-generators"}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"category":"Gatsby"}}}